<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Automation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìß</text></svg>">
</head>
<body>
    <center>
    <h1>Email Sender üì©</h1>
    <img src="https://cdn-icons-png.flaticon.com/512/561/561127.png" alt="Send Email" width="80" height="80" class="email-icon">
    <p>Schedule your Email here ‚¨áÔ∏è </p>
    <button id="compose-btn">Write an email</button>
    <div id="compose-container"></div>
    </center>
    <script>
document.getElementById('compose-btn').addEventListener('click', function() {
    const composeBtn = document.getElementById('compose-btn');
    const container = document.getElementById('compose-container');
    // Prevent multiple boxes
    if (container.innerHTML.trim() !== "") return;
    // Hide the original button
    composeBtn.style.display = 'none';
    // Create email input
    const emailInput = document.createElement('input');
    emailInput.type = 'email';
    emailInput.placeholder = 'Recipient\'s email address';
    emailInput.className = 'email-input';
    emailInput.required = true;
    container.appendChild(emailInput);
    // Create textarea
    const textarea = document.createElement('textarea');
    textarea.placeholder = "Compose your email...";
    textarea.className = "compose-box";
    container.appendChild(textarea);
    // Create new button below textarea
    const sendBtn = document.createElement('button');
    sendBtn.textContent = 'Send Email';
    sendBtn.className = 'send-btn';
    sendBtn.style.display = 'block';
    sendBtn.style.margin = '20px auto 0 auto';
    container.appendChild(sendBtn);

    // Add send button functionality
    sendBtn.addEventListener('click', async function() {
        // Remove any previous error
        const prevError = document.getElementById('email-error');
        if (prevError) prevError.remove();

        // Validate email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value)) {
            // Show error message
            const error = document.createElement('div');
            error.id = 'email-error';
            error.textContent = 'Error: Please enter a valid email address';
            error.style.color = 'red';
            error.style.textAlign = 'center';
            error.style.marginTop = '10px';
            container.insertBefore(error, textarea);
            return;
        }

        // Validate message
        if (!textarea.value.trim()) {
            const error = document.createElement('div');
            error.id = 'email-error';
            error.textContent = 'Error: Please enter a message';
            error.style.color = 'red';
            error.style.textAlign = 'center';
            error.style.marginTop = '10px';
            container.insertBefore(error, textarea);
            return;
        }

        // Show loading state
        sendBtn.textContent = 'Sending...';
        sendBtn.disabled = true;

        try {
            // Send email to backend
            const response = await fetch('/send-email', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    to: emailInput.value,
                    subject: 'Message from Email Sender App',
                    message: textarea.value
                })
            });

            const result = await response.json();

            if (result.success) {
                // Show success message
                container.innerHTML = '';
                const confirmation = document.createElement('div');
                confirmation.textContent = 'Your email has been sent successfully!';
                confirmation.style.textAlign = 'center';
                confirmation.style.marginTop = '20px';
                confirmation.style.fontWeight = 'bold';
                confirmation.style.color = '#2563eb';
                container.appendChild(confirmation);

                // Show the original button again after a delay
                setTimeout(function() {
                    container.innerHTML = '';
                    composeBtn.style.display = 'inline-block';
                }, 3000);
            } else {
                // Show error message
                const error = document.createElement('div');
                error.id = 'email-error';
                error.textContent = `Error: ${result.error}`;
                error.style.color = 'red';
                error.style.textAlign = 'center';
                error.style.marginTop = '10px';
                container.insertBefore(error, textarea);

                // Reset button
                sendBtn.textContent = 'Send Email';
                sendBtn.disabled = false;
            }
        } catch (error) {
            console.error('Error sending email:', error);
            
            // Show error message
            const errorDiv = document.createElement('div');
            errorDiv.id = 'email-error';
            errorDiv.textContent = 'Error: Failed to send email. Please check your connection and try again.';
            errorDiv.style.color = 'red';
            errorDiv.style.textAlign = 'center';
            errorDiv.style.marginTop = '10px';
            container.insertBefore(errorDiv, textarea);

            // Reset button
            sendBtn.textContent = 'Send Email';
            sendBtn.disabled = false;
        }
    });
});
</script>
</body>
</html>
